---
import BaseLayout from "./BaseLayout.astro";
import SearchDialog from "../components/ui/SearchDialog.tsx";
import type { Language } from "../utils/i18n";
import { wordpressClient } from "../utils/wordpressClient";
import type { SearchablePost } from "../components/ui/SearchDialog.tsx";

export interface Props {
  title?: string;
  description?: string;
  lang: Language;
  canonicalPath?: string;
}

const { title = "Arawi Aura", description, lang, canonicalPath } = Astro.props;

// Get posts for search functionality
let searchPosts: SearchablePost[] = [];

try {
  const allPostsResult = await wordpressClient.getPosts(1000);
  searchPosts = allPostsResult.posts.map((post) => ({
    id: post.id,
    slug: post.slug,
    title: post.title,
    content: post.content,
    excerpt: post.excerpt || "",
    language: post.language,
    categories: post.categories,
    tags: post.tags,
  }));
} catch (error) {
  console.error("Error fetching posts for search:", error);
}
---

<BaseLayout {title} {description} {lang} {canonicalPath}>
  <SearchDialog client:load posts={searchPosts} {lang} />
  <slot />
</BaseLayout>
