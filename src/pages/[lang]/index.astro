---
import MainLayout from "../../layouts/MainLayout.astro";
import WordPressPostList from "../../components/content/WordPressPostList.astro";
import type { Language } from "../../utils/i18n";
import { translations } from "../../utils/i18n";
import { wordpressClient } from "../../utils/wordpressClient";

export async function getStaticPaths() {
  return [{ params: { lang: "es" } }, { params: { lang: "en" } }];
}

const { lang } = Astro.params;
const validLang: Language = lang === "es" || lang === "en" ? lang : "en";
const t = translations[validLang];

// Get posts for this language
let posts: any[] = [];
let grouped: Record<string, Record<string, any[]>> = {};

try {
  posts = await wordpressClient.getPostsByLanguage(validLang);
  grouped = wordpressClient.groupPostsByDate(posts);
} catch (error) {
  console.error("Error fetching posts:", error);
}

const pageTitle = t.home;
const pageDescription =
  validLang === "es"
    ? "Explora el diario de poesía Arawi Aura. Poemas en español e inglés organizados por año y mes."
    : "Explore the Arawi Aura poetry journal. Poems in English and Spanish organized by year and month.";
---

<MainLayout
  title={pageTitle}
  description={pageDescription}
  lang={validLang}
  canonicalPath={`/${validLang}/`}
>
  <WordPressPostList
    posts={posts}
    lang={validLang}
    showHeader={true}
    showYearHeaders={true}
    groupByDate={true}
  />
</MainLayout>
